<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page import="sm.data.CommentDAO" %>
<%--
	ìž‘ì„±ìž : ì‹ ë™ì—½
	 íŒŒì¼ëª… : comment_delete.jsp
	ë‚´ìš© : ëŒ“ê¸€ ì‚­ì œ ì²˜ë¦¬ íŽ˜ì´ì§€
	       - ëª©ë¡ ë˜ëŠ” ìƒì„¸ë³´ê¸°ì—ì„œ ì „ë‹¬ëœ ê¸€ ë²ˆí˜¸(id,boardNum,password)ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ
	       - BoardDAOë¥¼ í†µí•´ í•´ë‹¹ ê²Œì‹œê¸€ ì‚­ì œ ì²˜ë¦¬
	       - ì‚­ì œ ì™„ë£Œ í›„ ê²Œì‹œê¸€ ëª©ë¡ íŽ˜ì´ì§€(view.jsp)ë¡œ ì´ë™
	       ðŸ“Œ ì‚¬ìš©ìž ê¸°ëŠ¥
	       
1. ëŒ“ê¸€ ì‚­ì œ ì²˜ë¦¬ ê¸°ëŠ¥
   - ìƒì„¸ë³´ê¸°(view.jsp)ì—ì„œ ì „ë‹¬ëœ ëŒ“ê¸€ ë²ˆí˜¸(id), ê²Œì‹œê¸€ ë²ˆí˜¸(boardNum), ë¹„ë°€ë²ˆí˜¸(password) ë°›ê¸°
   - ìž…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ëŠ” ê²½ìš° í•´ë‹¹ ëŒ“ê¸€ì„ DBì—ì„œ ì‚­ì œ
   - ì‚­ì œ ì„±ê³µ ì‹œ í•´ë‹¹ ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°(view.jsp)ë¡œ ì´ë™
   - ì‚­ì œ ì‹¤íŒ¨ ì‹œ ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜ ë©”ì‹œì§€ ì¶œë ¥ í›„ ì´ì „ íŽ˜ì´ì§€ë¡œ ì´ë™

ðŸ“Œ êµ¬í˜„ ë°©ë²•
1. íŒŒë¼ë¯¸í„° ì²˜ë¦¬
   - request.getParameter()ë¡œ id, boardNum, password ê°’ ë°›ê¸°
   - id, boardNumì€ Integer.parseInt()ë¡œ ì •ìˆ˜ ë³€í™˜
   - null ì²´í¬ë¡œ ìž˜ëª»ëœ ì ‘ê·¼ ë°©ì§€

2. DAO ê°ì²´ ì‚¬ìš©
   - CommentDAO ê°ì²´ ìƒì„±
   - deleteComment(id, password) ë©”ì„œë“œ í˜¸ì¶œ
   - id + password ì¼ì¹˜ ì—¬ë¶€ë¡œ ì‚­ì œ ì²˜ë¦¬

3. ê²°ê³¼ ë¶„ê¸° ì²˜ë¦¬
   - deleteComment() ë°˜í™˜ê°’(boolean) í™•ì¸
   - true â†’ ì‚­ì œ ì„±ê³µ
   - false â†’ ì‚­ì œ ì‹¤íŒ¨ (ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜)

4. íŽ˜ì´ì§€ ì´ë™ ì²˜ë¦¬
   - response.sendRedirect()ë¡œ ìƒì„¸ë³´ê¸° íŽ˜ì´ì§€ ì´ë™
   - ì‹¤íŒ¨ ì‹œ alert() í›„ history.back() ì‹¤í–‰
   - íŒŒë¼ë¯¸í„°ê°€ ì—†ìœ¼ë©´ list.jspë¡œ ì´ë™
 --%>
 
<%
    // 1ï¸ í•œê¸€ ê¹¨ì§ ë°©ì§€
    request.setCharacterEncoding("UTF-8");

    //  ì „ë‹¬ëœ íŒŒë¼ë¯¸í„° ë°›ê¸°
    String idStr = request.getParameter("id");
    String boardNumStr = request.getParameter("boardNum");
    String password = request.getParameter("password");

    // 3ï¸ íŒŒë¼ë¯¸í„° null ì²´í¬
    if(idStr != null && boardNumStr != null && password != null) {

        // 4ï¸ ë¬¸ìžì—´ â†’ ì •ìˆ˜í˜• ë³€í™˜
        int id = Integer.parseInt(idStr);
        int boardNum = Integer.parseInt(boardNumStr);

        // 5ï¸ DAO ê°ì²´ ìƒì„±
        CommentDAO cdao = new CommentDAO();

        // 6ï¸ ëŒ“ê¸€ ì‚­ì œ (id + password ì¼ì¹˜ ì—¬ë¶€ í™•ì¸)
        boolean deleted = cdao.deleteComment(id, password);

        // 7ï¸ ì‚­ì œ ê²°ê³¼ì— ë”°ë¥¸ ì²˜ë¦¬
        if(deleted) {
            //  ì‚­ì œ ì„±ê³µ â†’ í•´ë‹¹ ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸° íŽ˜ì´ì§€ë¡œ ì´ë™
            response.sendRedirect("view.jsp?num=" + boardNum);
        } else {
            // âŒ ì‚­ì œ ì‹¤íŒ¨ â†’ ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜
%>
            <script>
                alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
                history.back();
            </script>
<%
        }

    } else {
        // âš  ìž˜ëª»ëœ ì ‘ê·¼ â†’ ëª©ë¡ íŽ˜ì´ì§€ë¡œ ì´ë™
        response.sendRedirect("list.jsp");
    }
%>
